#!/usr/bin/env bash

__dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

get_help() {
    echo "A tool to help schedule studies
    It considers a study period one hour and you cannot study in a row.

    Usage:

    $0 -d 'clean code' 'I studied X Y Z' to mark a session of clean code as done
    $0 --list-subjects                   to list all subjects
    $0 --edit-subjects                   opens the subjects on your editor
    $0 --edit-history                    opens the history on your editor

    $0 --summary                         displays statistics about your usage
    "
}

[[ "$@" =~ "--help" ]] || [[ "$@" =~ ^-h$ ]]&& {
    get_help
    exit
}

[[ "$@"  == "-d" ]] || [[ "$@"  == "--done" ]]  && {
    echo "$( date "+%Y-%m-%d %H:%M:%S")|$2|$3" >> ~/.scheduler_history
    exit
}

[[ "$@"  == "--summary" ]] && {
    echo "Done Today: "$($__dir/gateway.sh done_today | wc -l)
    echo "Done Week: "$($__dir/gateway.sh done_week | wc -l)
    exit
}


[[ "$@"  == "--log" ]] && {
    log_data() {
    log=$(tac ~/.scheduler_history)
    current_entry=$(echo "$log" | wc -l )
IFS='
'
    for i in $log
    do
        date=$(echo $i | cut -d '|' -f1)
        subject=$(echo $i | cut -d '|' -f2)
        description=$(echo $i | cut -d '|' -f3)
        echo -e "\e[5;33;40m $current_entry $subject \e[0m"
        echo "Date:     $date"
        echo "      $description"

        echo ""
        current_entry=$(( $current_entry - 1 ))

    done
}

    log_data | less
    exit
}



[[ "$@"  == "--list-subjects" ]] && {
    $__dir/gateway.sh list_subjects_names
    exit
}

[[ "$@"  == "--edit-subjects" ]] && {
    [ ! -z ${EDITOR+x} ] && {
        $EDITOR ~/.scheduler
    } || {
        vim ~/.scheduler
    }
    exit
}

[[ "$@"  == "--edit-history" ]] && {
    [ ! -z ${EDITOR+x} ] && {
        $EDITOR ~/.scheduler_history
    } || {
        vim ~/.scheduler_history
    }
    exit
}

[[ "$@"  == "--list" ]] && {
    $__dir/scheduler.py
    exit
}

get_help
